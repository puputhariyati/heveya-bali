{% extends 'base.html' %}

{% block title %}Delivery{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='delivery.css') }}">
{% endblock %}

{% block content %}
<h2>Delivery Tracking Table</h2>

<form method="post" action="/save_delivery_data">
    <!-- Bulk controls -->
    <div style="margin: 10px 0;">
        <label><strong>Bulk Delivery Date:</strong></label>
        <input type="date" id="bulk-delivery-date">
        <button type="button" onclick="applyBulkDate()">Apply to Selected</button>
    </div>

    <table border="1" cellpadding="8" cellspacing="0">
        <thead>
            <tr>
                <th><input type="checkbox" onclick="toggleAll(this)"></th>
                <th>Transaction No</th>
                <th>Date</th>
                <th>Customer</th>
                <th>Product</th>
                <th>Qty</th>
                <th>Delivered</th>
                <th>Remain Qty</th>
                <th>Purchase No</th>
                <th>Delivery Date</th>
                <th>Warehouse</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><input type="checkbox" class="row-check"></td>
                <td>SO-1001</td>
                <td>2025-06-10</td>
                <td>PT Sejuk Hati</td>
                <td>Heveya Mattress King</td>
                <td><input type="number" class="qty" name="qty" value="2" readonly></td>
                <td><input type="number" class="delivered" name="delivered" min="0" value="0" oninput="updateRemain(this)"></td>
                <td><input type="number" class="remain_qty" name="remain_qty" value="2" readonly></td>
                <td><input type="text" name="purchase_no"></td>
                <td><input type="date" name="delivery_date"></td>
                <td>
                    <select name="warehouse">
                        <option value="Warehouse">Warehouse</option>
                        <option value="Showroom">Showroom</option>
                        <option value="Done">Done</option>
                    </select>
                </td>
            </tr>

            <tr>
                <td><input type="checkbox" class="row-check"></td>
                <td>SO-1002</td>
                <td>2025-06-12</td>
                <td>CV Green Living</td>
                <td>Organic Latex Pillow</td>
                <td><input type="number" class="qty" name="qty" value="4" readonly></td>
                <td><input type="number" class="delivered" name="delivered" min="0" value="0" oninput="updateRemain(this)"></td>
                <td><input type="number" class="remain_qty" name="remain_qty" value="4" readonly></td>
                <td><input type="text" name="purchase_no"></td>
                <td><input type="date" name="delivery_date"></td>
                <td>
                    <select name="warehouse">
                        <option value="Warehouse">Warehouse</option>
                        <option value="Showroom">Showroom</option>
                        <option value="Done">Done</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>

    <br>
    <button type="submit">Save</button>
</form>

<script>
    function applyBulkDate() {
        const bulkDate = document.getElementById("bulk-delivery-date").value;
        if (!bulkDate) {
            alert("Please choose a date first.");
            return;
        }

        document.querySelectorAll("tr").forEach(row => {
            const checkbox = row.querySelector(".row-check");
            const dateInput = row.querySelector("input[name='delivery_date']");
            if (checkbox && checkbox.checked && dateInput) {
                dateInput.value = bulkDate;
            }
        });
    }

    function toggleAll(source) {
        const checkboxes = document.querySelectorAll(".row-check");
        checkboxes.forEach(cb => cb.checked = source.checked);
    }

    function updateRemain(input) {
        const row = input.closest("tr");
        const qty = parseInt(row.querySelector(".qty").value) || 0;
        const delivered = parseInt(input.value) || 0;
        const remainInput = row.querySelector(".remain_qty");
        remainInput.value = Math.max(qty - delivered, 0);
    }
</script>
{% endblock %}
