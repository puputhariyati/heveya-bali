{% extends 'base.html' %}

{% block title %}Sales Order{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='sales_order.css') }}">
{% endblock %}

{% block content %}
    <div class="main-content">
        <div class="top-bar">
            <select id="status" onchange="filterOrders()">
                <option value="">All</option>
                <option value="open">Open</option>
                <option value="partially sent">Partially Sent</option>
                <option value="closed">Closed</option>
            </select>
            <input type="text" id="searchBox" placeholder="Search Customer / Order No" oninput="filterOrders()" />
          <!-- View Switch Tabs -->
          <div class="tabs">
            <button onclick="showTableView()">Table View</button>
            <button onclick="showCalendarView()">Calendar View</button>
          </div>
          <div id="delivery-calendar" style="display:none;"></div>
        </div>

        <div style="text-align: center">
            <p>Bulk Edit : </p>
            <button onclick="bulkUpdateStatus('closed')">Close Orders</button>
            <input type="date" id="bulk-etd" />
            <button onclick="bulkUpdateETD()">Set ETD</button>
        </div>

        <!-- Calendar Modal -->
        <div id="calendarModal" class="calendar-modal">
          <div class="calendar-content">
            <span class="close-btn" onclick="closeCalendar()">&times;</span>
            <h3 id="calendarTitle"></h3>
            <div id="calendarGrid" class="calendar-grid"></div>
          </div>
        </div>


        <!-- Sales Order Table -->
        <div id="delivery-table">
          <h2>Sales Orders</h2>
            <table>
              <thead>
                <tr>
                  <th><input type="checkbox" onclick="toggleAll(this)"></th>
                  <th>Date</th>
                  <th>Order No</th>
                  <th>Customer</th>
                  <th>Balance Due</th>
                  <th>Total</th>
                  <th>Status</th>
                  <th>ETD</th>
                </tr>
              </thead>
              <tbody>
                {% for order in orders %}
                <tr>
                    <td><input type="checkbox" class="row-check"></td>
                    <td>{{ order.transaction_date }}</td>
                    <td><a href="/sales_order/{{ order.transaction_no }}">{{ order.transaction_no }}</a></td>
                    <td>{{ order.customer or '-' }}</td>
                    <td>{{ order.balance_due or '-' }}</td>
                    <td>{{ order.total or '-' }}</td>
                    <td>{{ order.status.capitalize() }}</td>
                    <td>
                      <input type="date" name="ETD" value="{{ order.etd }}"
                             onchange="updateETD('{{ order.transaction_no }}', this.value)">
                    </td>
                </tr>
                {% endfor %}
              </tbody>

            </table>
            <br>
          </form>
        </div>
    </div>

    <script>
      const salesOrders = {{ orders | tojson }};
    </script>
    <script src="{{ url_for('static', filename='sales_order.js') }}"></script>


{% endblock %}
